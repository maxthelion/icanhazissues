extends board-layout

block card
  if i.assignee
    div(class='issue-text col-xs-8')
      a(href='#{i.url}' target='_blank') #{i.title}
    div(class='issue-assignee col-xs-4 pull-right')
      span(class='pull-right')
        img(src='#{i.assignee.avatar_url}&s=40' class='img-circle avatar')
  else
    div(class='issue-text col-xs-12')
      a(href='#{i.url}' target='_blank') #{i.title}

block content
  - // Replace all spaces with a `-` when naming classes
  - var dash = function(text) {
  -  return text.replace(/ /g, '-');
  -}
  
  - // Check for blocked issues
  - var blocked = function _checkLabelMatches(issue) {
  -  for(var i = 0; i < issue.label.length; i++) {
  -    if (issue.label[i].name == 'blocked') {
  -      return true;
  -    }
  -  }
  - }

  nav(class='navbar navbar-default navbar-fixed-top board-navbar')
    div(class='container-fluid heading-container')
      each col in columns
        div(class='col-md-3 heading-column') #{col}
  div(class='retrospective-bar col-md-12')
    a(href='#' data-toggle='modal' data-target='#retrospective-modal') Retrospective Reminders

  each val, key in issues
    div(class='container-fluid')
      div(class='row heading-row')
        div(class='milestone-heading')
          p(class='milestone-heading-text') #{key}
        each v, k in val
          div(class='col-md-3 board-columns' id='#{key}-#{k}-column')
            div(class='panel board-panel panel-default')
              div(class='panel-heading board-panel-heading')
              div(class='panel-body board-panel-body')
                ul(class='list-group issue-list-group #{dash(key)}-#{k}-list-group' data-label='#{k}' data-milestone='#{key}')
                  each i in v
                    if blocked(i)
                      li(class='list-group-item issue-list-item' data-created='#{i.createdAt}' data-blocked='true' data-issue-number='#{i.issueNumber}' id='#{k}-#{i.issueNumber}')
                        block card
                    else
                      li(class='list-group-item issue-list-item' data-created='#{i.createdAt}' data-issue-number='#{i.issueNumber}' id='#{k}-#{i.issueNumber}')
                        block card
                          
  div(class='modal fade retro-modal' id='retrospective-modal' tabindex='-1' role='dialog' aria-labelledby='retro-modal' aria-hidden='true')
    div(class='modal-dialog')
      div(class='modal-content')
        div(class='modal-header')
          button(type='button' class='close' data-dismiss='modal' aria-label='Close')
            span(aria-hidden='true')&times;
          h4(class='modal-title') Retrospective Reminders
        
        div(class='modal-body retro-modal-body')
                
        div(class='modal-footer')
          button(type='button' class='btn btn-default' data-dismiss='modal') Close


  script.
    var pusherKey = '#{pusherKey}';
    var newIssueUrl = '#{newIssueUrl}';
