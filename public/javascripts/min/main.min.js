function updateIssue(e,t,a,o){{var s=window.location.pathname.split("/")[3],i="/issues/"+s+"/update/"+e,l={oldLabel:t,newLabel:a,blocked:o};$.ajax({url:i,type:"POST",data:l,success:function(e){console.log(e)},error:function(e){console.log("Error: "+JSON.parse(e))}})}}function _getColourCode(e){var e=new Date(e),t=new Date,a=t-e,o=864e5,s=t-t%o-o;return e>s?"#00B16A":7*o>a?"#F7CA18":14*o>a?"#F9690E":"#F22613"}function _assignColourCode(){$(".issue-list-item").each(function(){var e=_getColourCode($(this).attr("data-created"));$(this).css("border-bottom-width","5px").css("border-bottom-color",e)})}function _addBlockedLabel(){$('.issue-list-item[data-blocked="true"]').each(function(){var e='<span class="label label-danger">BLOCKED</span>';$(this).find(".issue-text").append("  "+e)})}function _addMenu(){$(".heading-column:first-child").append('<a class="menu-button pull-left" data-toggle="dropdown" id="menu-dropdown"><i class="fa fa-bars fa-sm"></i></a><ul class="dropdown-menu" role="menu" aria-labelledby="menu-dropdown"><li role="presentation" class="dropdown-header">'+window.location.pathname.split("/")[3]+'</li><li role="presentation"><a role="menuitem" tabindex="-1" href="/repos">Repository search</a></li><li role="presentation"><a role="menuitem" tabindex="-1" href="#">Retrospective reminders</a></li><li role="presentation"><a role="menuitem" tabindex="-1" href="/logout">Logout</a></li></ul>')}function _addNewIssueButton(){$(".heading-column:last-child").append('<a class="add-issue-button pull-right" target="_blank" href="'+newIssueUrl+'"><i class="fa fa-plus fa-sm"></i></a>')}var pusher=new Pusher(pusherKey,{authEndpoint:"/pusher/auth"}),channel=pusher.subscribe("private-issues");channel.bind("client-issue-updates",function(e){var t="#"+e.fromLabel+"-"+e.issueNumber;$(t).remove();var a="."+e.milestone.replace(/ /g,"-")+"-"+e.toLabel+"-list-group";$(a).append(e.cardHtml)});for(var issueGroups=document.getElementsByClassName("issue-list-group"),fromLabel="",toLabel="",fromMilestone="",toMilestone="",i=0;i<issueGroups.length;i++){var issueMilestone=issueGroups[i].getAttribute("data-milestone");Sortable.create(issueGroups[i],{group:"issue-"+issueMilestone,animation:150,dragable:".issue-list-item",ghostClass:"sortable-ghost",onStart:function(e){var t=e.item.parentNode;fromLabel=t.getAttribute("data-label"),fromMilestone=t.getAttribute("data-milestone")},onEnd:function(e){var t=e.item.getAttribute("data-issue-number"),a=e.item.parentNode,o=!1;toLabel=a.getAttribute("data-label"),toMilestone=a.getAttribute("data-milestone"),"true"==e.item.getAttribute("data-blocked")&&(o=!0);var s={issueNumber:t,milestone:toMilestone,fromLabel:fromLabel,toLabel:toLabel};fromLabel!=toLabel&&fromMilestone==toMilestone&&(e.item.setAttribute("id",toLabel+"-"+t),s.cardHtml=e.item.outerHTML,channel.trigger("client-issue-updates",s),updateIssue(t,fromLabel,toLabel,o))}})}$(window).load(function(){_addMenu(),_addNewIssueButton(),_assignColourCode(),_addBlockedLabel()});